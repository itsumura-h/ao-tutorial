# `ao`におけるメッセージング

## メッセージが`ao`に並列計算能力を与える方法を学ぶ

`ao`では、すべてのプロセスが並列で実行され、非常にスケーラブルな環境を作り出します。各プロセスが独立して非同期で動作するため、従来のプロセス間の直接的な関数呼び出しは実現不可能です。

メッセージングは、非同期通信を可能にすることでこの問題に対処します。プロセスはお互いに直接関数を呼び出すのではなく、メッセージを送受信します。この方法により、プロセス間の柔軟で効率的な相互作用が可能になり、システムのスケーラビリティと応答性が向上します。

まず、`aos`におけるメッセージングの基本、受信トレイで受信したメッセージの確認方法、および他のプロセスにメッセージを送信する方法について学びます。

## ビデオチュートリアル

<iframe width="680" height="350" src="https://www.youtube.com/embed/6aCjKK6F1yQ?si=3Ny7U-GgyNsRWlXS" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## ステップ1：メッセージの構造を理解する

- **メッセージの基本:** `ao`のメッセージはLuaテーブルを使用して構築されます。これは複数の値を保持できる多用途のデータ構造です。このテーブルの中で「Data」フィールドが重要であり、メッセージの内容やペイロードが含まれます。この構造により、プロセス間の情報の効率的な送受信が可能になり、`ao`のプリミティブがArweaveの基盤となる機能を活用して複雑で構成可能な操作を促進する方法を示しています。

  詳細な仕様については、[G8way仕様ページ](https://specs.g8way.io/?tx=xwOgX-MmqN5_-Ny_zNu2A8o-PnTGsoRb_3FrtiMAkuw)の元のドキュメントを参照してください。

- **例**: `{ Data = "Hello from Process A!" }`はシンプルなメッセージです。

## ステップ2：aos CLIを開く

- ターミナルで`aos`と入力し、Enterキーを押してaosコマンドラインインターフェイス（CLI）を起動します。

```sh
aos
```

## ステップ3：メッセージを送信する方法

```lua
Send({ Target = "process ID", Data = "Hello World!" })
```

- **Send**: `Send`関数はaosインタラクティブ環境でグローバルに利用可能です。
- **Target**: 特定のプロセスにメッセージを送信するには、メッセージに`Target`フィールドを含めます。
- **Data**: `Data`は受信プロセスに受信させたいテキストメッセージです。この例では、メッセージは「Hello World!」です。

## ステップ4：`Morpheus`のプロセスIDを保存する

以下に提供されたプロセスIDを使用し、それをMorpheusという変数として保存します。

```lua
ajrGnUq9x9-K1TY1MSiKwNWhNTbq7-IdtFa33T59b7s
```

上記のプロセスIDをコピーし、次のコマンドをaos CLIで実行して変数として保存します：

```lua
Morpheus = "ajrGnUq9x9-K1TY1MSiKwNWhNTbq7-IdtFa33T59b7s"
```

これにより、プロセスIDがMorpheusという変数として保存され、特定のプロセスIDと対話する際に便利になります。

::: info
`Morpheus`変数を作成すると、「undefined」という応答が表示されるだけです。これは予期された動作です。変数が正しく作成されたかどうかを確認するには、`Morpheus`と入力してEnterキーを押します。保存されたプロセスIDが表示されるはずです。
:::

### `Morpheus`変数を確認する

```lua
-- Morpheus変数を確認するには、`Morpheus`と入力します
 Morpheus
-- 期待される結果:
ajrGnUq9x9-K1TY1MSiKwNWhNTbq7-IdtFa33T59b7s


-- `undefined`が返された場合、
-- 変数が正常に作成されませんでした。
```

## ステップ5：Morpheusにメッセージを送信する

MorpheusのプロセスIDを取得して変数に保存した後、彼と通信する準備が整います。これを行うには、Send関数を使用します。Morpheus自体はaoで動作する並列プロセスであり、ハンドラを使用してメッセージを送受信します。メッセージを送信して、何が起こるか見てみましょう。

```lua
Send({Target = Morpheus, Data = "Morpheus?"}).receive().Data
```

- `Target`は先ほど定義した`Morpheus`変数です。
- `Data`はMorpheusに送信したいメッセージです。この場合、「Morpheus?」です。

**期待される結果:**

```lua
-- あなたのメッセージコマンド
Send({Target = Morpheus, Data = "Morpheus?"})
-- メッセージは送信ボックスに追加されました
{
   output = "Message added to outbox",
   onReply = function: 0x29b0ba0,
   receive = function: 0x29b0c40
}
-- `Morpheus`のプロセスIDから新しいメッセージが受信されました
New Message From BWM...ulw: Data = I am here. You are f

```

Morpheusにメッセージを送信し、応答を受け取りましたが、メッセージ全体を読むことができません。受信トレイについて学び、メッセージを読む方法を見てみましょう。

## ステップ6：受信トレイ

`Inbox`は他のプロセスからのメッセージを受信する場所です。
::: info
受信トレイメッセージの詳細な表示方法については、[Messages](../../concepts/messages)のコンセプトページを参照してください。
:::

受信トレイのメッセージ数を確認してみましょう。

aos CLI内で次のコマンドを入力します：

```lua
 #Inbox
```

このチュートリアルに従っている場合、受信トレイには多くのメッセージが含まれていないはずです。しかし、aos環境での実験を続けている場合、受信トレイには複数のメッセージがあるかもしれません。

**例の返答:**

```lua
-- あなたの受信トレイコマンド
 #Inbox
-- 受信トレイにあるメッセージの数が返されます。
4

```

上記の例では、返答は`4`で、受信トレイに4つのメッセージがあることを示しています。

現在、`Morpheus`からの応答を探しているので、彼のメッセージが最後に受信されたものと仮定します。受信トレイの最後のメッセージを読むには、次のコマンドを入力します：

```lua
 Inbox[#Inbox].Data
```

このコマンドにより、メッセージのデータのみを読み取ることができます。

期待される返答：

```lua
-- あなたの受信トレイ[x].Dataコマンド
 Inbox[#Inbox].Data
-- コマンドはメッセージの`Data`を返します。
-- `Data`は通常、プロセス間で受信されたテキストベースのメッセージを表します。
I am here. You are finally awake. Are you ready to see how far the rabbit hole goes?

```

あなたは現在、自分のプロセスを使用して、aoで動作する別の並列プロセスであるMorpheusと通信しています。次のステップに進む準備が整いました。

## ステップ7：メッセージの待機

`.receive`関数を使用して、応答を待ち、その後さらにコマンドを実行できます。

```lua
Send({Target = Morpheus, Data = "Morpheus?" }).receive().Data
-- I am here. You are finally awake. Are you ready to see how far the rabbit hole goes?
```

## ステップ8：タグ付きメッセージの送信

**タグの目的**: aosメッセージのタグは、メッセージの分類、ルーティング、および処理を効率的に行うために使用されます。複数のプロセスや複雑なワークフローを扱う際に、特に重要な役割を果たします。

一部のプロセスは、特定のタグを持つメッセージと対話する`Handlers`を使用します。たとえば、特定のタグを持つメッセージと対話するハンドラを持つプロセスがあります。この例は[チャットルーム](chatroom)のチュートリアルで確認できます。

### メッセージでタグを使用する方法

Morpheusの場合、タグを使用してメッセージを分類できます。Morpheusは自律プロセスであり、特定のタグを持つメッセージと対話するハンドラを持っています。

**メッセージにタグを追加する**:

- すでに知っているように、メッセージの`Data`は他のプロセスに送信したいテキストベースのメッセージです。以前はタグなしでMorpheusにメッセージを送信し、彼は正確に一致するデータに応答するハンドラを使用しました。

### 準備ができていることをMorpheusに示す

`Action`タグと値`rabbithole`を使用してMorpheusにメッセージを送信します。

**例**:

```lua
Send({ Target = Morpheus, Data = "Code: rabbithole", Action = "Unlock" }).receive().Data
```

**期待される返答**:
![Morpheus Responds 2](/messaging2.png)

## タグの使用に関する追加のヒント

- **一貫したタグ付け**: アプリケーションのメッセージ処理を予測可能にするために、一貫したタグ付けシステムを開発してください。
- **タグの命名**: 明確で説明的な名前を選びます。これにより、メッセージの目的とコンテキストを一目で理解できます。
- **セキュリティ**: タグは暗号化されておらず、隠されていないため、機密情報をタグとして使用しないでください。

## タグの高度な使用方法

- **ワークフロー管理**: メッセージが複数のステージやプロセスを通過するシステムでは、タグはワークフロー管理に非常に役立ちます。

## メッセージングの追加のヒント

- **メッセージ構造**: `Epoch`、`From`、`Nonce`などの他のフィールドを探索し、より複雑なメッセージングニーズに対応します。
- **デバッグ**: メッセージをデバッグするために[`Dump`](/concepts/tour.html#_6-data-representation-with-dump)関数を使用してメッセージを表示します。
- **セキュリティ考慮**: メッセージの内容と取り扱いに注意し、機密情報やプライベート情報を送信しないでください。

## 結論

タグを使用してメッセージを送信する方法を学びました。これは、aosでメッセージを分類およびルーティングするための強力なツールです。

Morpheusは次の段階への旅にあなたを正式に招待しました。次のステップ、[チャットルームの作成](chatroom)のチュートリアルに進む準備が整いました。
